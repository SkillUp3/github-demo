add a bunch of code.. and fix some bugs
